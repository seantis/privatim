<metal:block use-macro="main_template"
             xmlns="http://www.w3.org/1999/xhtml"
             xmlns:tal="http://xml.zope.org/namespaces/tal"
             xmlns:metal="http://xml.zope.org/namespaces/metal"
         i18n:domain="privatim">

    <tal:block metal:fill-slot="content">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 i18n:translate="">${title}</h1>
                </div>

                <tal:b  tal:condition="show_add_button">
                    <div class="col-md-6 text-end">
                        <a i18n:translate="" href="${request.route_url('add_consultation')}"
                                             class="btn btn-primary" role="button" tabindex="1">Add Consultation</a>
                    </div>
               </tal:b>

            </div>

            <div class="row">
                <!-- Main content area (2/3 width) -->
                <div class="col-md-8 order-md-1">
                    <tal:b tal:condition="not:activities">
                        <p class="lead" i18n:translate="">No activities added yet. You can add activities in the
                            Consultations tab or by adding a Meeting of a Working Group.</p>
                    </tal:b>

                    <div tal:repeat="activity activities" class="mt-5">
                    <?python
                            from privatim.models import Consultation, Meeting
                            is_consultation = isinstance(activity, Consultation)
                            is_meeting = isinstance(activity, Meeting)

                            if is_consultation and activity.comments:
                                    activity.comments = activity.comments if len(activity.comments) < 100 else activity.comments[:100] + '...'

                            if is_consultation and activity.description:
                                    activity.description = activity.description if len(activity.description) < 100 else activity.description[:100] + '...'

                            if is_consultation and activity.recommendation:
                                    activity.recommendation = activity.recommendation if len(activity.recommendation) < 100 else activity.recommendation[:100] + '...'

                            ?>

                        <div class="card d-flex flex-row">
                            <div class="profile-section">
                                <img src="${layout.static_url('privatim:static/default_profile_icon.png')}"
                                     class="rounded-circle m-3 profile-icon" alt="Profile Icon">
                                <p class="profile-name" i18n:translate="">Max Müller</p>
                            </div>

                            <tal:b tal:switch="activity.__class__.__name__">
                                <div tal:case="'Consultation'" class="card-body col-md-8 d-flex flex-column">
                                    <h5 class="card-title fw-bold" i18n:translate="">${activity.title}</h5>
                                    <p class="card-text" i18n:translate="">${activity.comments}</p>
                                    <p class="card-text" i18n:translate="">${activity.recommendation}</p>
                                    <a href="${request.route_url('consultation', id=activity.id)}" i18n:translate=""
                                       class="details-link">-> Show Details</a>
                                </div>
                                <div tal:case="'Meeting'" class="card-body col-md-8 d-flex flex-column">
                                    <h5 class="card-title fw-bold" i18n:translate="">${activity.name}</h5>
                                    <p>
                                        <span class="fw-bold" i18n:translate="">Working Group:</span> ${activity.working_group.name}
                                    </p>
                                    <tal:b tal:condition="activity.attendees">
                                        <ul>
                                            <li tal:repeat="user activity.attendees">
                                                ${user.first_name} ${user.last_name}
                                            </li>
                                        </ul>
                                    </tal:b>
                                    <a href="${request.route_url('meeting', id=activity.id)}" i18n:translate=""
                                       class="details-link justify-content-end">-> Show Details</a>
                                </div>
                            </tal:b>

                            <div class="col-md-3 d-flex flex-column">
                                <div class="primary-tags d-flex flex-row justify-content-start">
                                    <tal:b tal:condition="is_meeting">
                                        <span class="badge rounded-pill mb-4 tag-button text-light fs-6 px-3 py-2" i18n:translate="">Meeting</span>
                                    </tal:b>

                                    <tal:b tal:condition="is_consultation">
                                        <span class="badge rounded-pill mb-4 tag-button text-light fs-6 px-3 py-2" i18n:translate="">Consultation</span>
                                    </tal:b>
                                </div>

                                <div tal:condition="is_consultation"
                                        class="secondary-tags d-flex flex-row justify-content-start">
                                    <tal:b tal:repeat="tag activity.secondary_tags">
                                        <span class="badge rounded-pill mb-4 bg-light text-dark fs-6 px-3 py-2 mx-1">${tag.name}</span>
                                    </tal:b>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar (1/3 width) -->
                <div class="col-md-4 order-md-2 mt-5">
                    <div class="mb-5 p-3">
                        <label for="kantonDropdown" class="form-label">Kanton</label>
                        <select class="form-select" id="kantonDropdown">
                            <option selected>Choose...</option>
                            <option value="1">Zürich</option>
                            <option value="2">Genf</option>
                            <option value="3">Bern</option>
                            <!-- Add other options here -->
                        </select>
                    </div>
                    <div class="mb-3 p-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="beratungCheck">
                            <label class="form-check-label" for="beratungCheck">
                                Beratung
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="vorabkontrollenCheck">
                            <label class="form-check-label" for="vorabkontrollenCheck">
                                Vorabkontrollen
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </tal:block>
</metal:block>
