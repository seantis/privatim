<metal:block use-macro="main_template"
             xmlns="http://www.w3.org/1999/xhtml"
             xmlns:tal="http://xml.zope.org/namespaces/tal"
             xmlns:metal="http://xml.zope.org/namespaces/metal"
         i18n:domain="privatim">

    <tal:block metal:fill-slot="content">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 i18n:translate="">${title}</h1>
                </div>

                <tal:b  tal:condition="show_add_button">
                    <div class="col-md-6 text-end">
                        <a i18n:translate="" href="${request.route_url('add_consultation')}"
                                             class="btn btn-primary" role="button" tabindex="1">Add Consultation</a>
                    </div>
               </tal:b>

            </div>

            <div class="row">
                <!-- Main content area (2/3 width) -->
                <div class="col-md-8 order-md-1">

                    <div tal:repeat="activity activities" class="mt-4">

                        <div class="card d-flex flex-row activity-card-wrapper">
                            <div class="profile-section m-3">
                                <img src="${layout.static_url('privatim:static/default_profile_icon.png')}"
                                     class="rounded-circle m-3 profile-icon" alt="Profile Icon">

                                <tal:b tal:switch="activity.__class__.__name__">
                                    <div tal:case="'Consultation'">
                                        <tal:define define="has_creator python: activity.creator is not None">
                                            <tal:condition condition="has_creator">
                                                <a tal:attributes="href request.route_url('person', id=activity.creator.id)">
                                                    <p class="profile-name" i18n:translate="">${activity.creator.fullname}</p>
                                                </a>
                                            </tal:condition>
                                            <tal:condition condition="not:has_creator">
                                                <p class="profile-name"
                                                   style="max-width: 150px; visibility: hidden;" i18n:translate="">
                                                    Unbekannter Ersteller</p>
                                            </tal:condition>
                                        </tal:define>
                                        <p class="text-secondary">${layout.format_date(activity.created, 'date')}  ${layout.format_date(activity.created, 'time')}</p>
                                    </div>
                                    <div tal:case="'Meeting'">
                                        <tal:define define="has_leader python: activity.working_group.leader is not None">
                                            <tal:condition condition="has_leader">
                                                <a tal:attributes="href request.route_url('person', id=activity.working_group.leader.id)">
                                                    <p class="profile-name" i18n:translate="">${activity.working_group.leader.fullname}</p>
                                                </a>
                                            </tal:condition>
                                            <tal:condition condition="not:has_leader">
                                                <p class="profile-name"
                                                   style="max-width: 150px; visibility: hidden;" i18n:translate="">
                                                    Kein Leiter</p>
                                            </tal:condition>
                                        </tal:define>
                                    </div>
                                </tal:b>
                            </div>

                            <tal:b tal:switch="activity.__class__.__name__">
                                <div tal:case="'Consultation'" class="card-body col-md-8 d-flex flex-column">
                                    <h5 class="card-title fw-bold" i18n:translate="">${activity.title}</h5>
                                    <!-- Note: We could use a .text-truncate class to truncate the text with an ellipsis.
                                    However, by using a fixed length, this approach minimizes variables and creates a more manageable and predictable layout.
                                    -->
                                    <p class="card-text" tal:condition="activity.recommendation" tal:content="activity.description if len(activity.description) < 100 else activity.description[:100] + '...'"></p>
                                    <a href="${request.route_url('consultation', id=activity.id)}" i18n:translate=""
                                       class="details-link">Show Details</a>
                                </div>
                                <div tal:case="'Meeting'" class="card-body col-md-8 d-flex flex-column">
                                    <h5 class="card-title fw-bold" i18n:translate="">${activity.name}</h5>
                                    <p>
                                        <span class="fw-bold" i18n:translate="">Working Group:</span> ${activity.working_group.name}
                                    </p>
                                    <tal:b tal:condition="activity.attendees">
                                        <ul>
                                            <li tal:repeat="user activity.attendees">
                                                <span tal:condition="user.first_name and user.last_name">${user.first_name} ${user.last_name}</span>
                                                <span tal:condition="not user.first_name and not user.last_name">${user.email}</span>
                                            </li>
                                        </ul>
                                    </tal:b>
                                    <a href="${request.route_url('meeting', id=activity.id)}" i18n:translate=""
                                       class="details-link justify-content-end">Show Meeting</a>
                                </div>
                            </tal:b>

                            <div class="col-md-3 d-flex flex-column">
                                <div class="primary-tags d-flex flex-row justify-content-start flex-wrap mt-3">
                                    <tal:b tal:condition="activity.__class__.__name__ == 'Meeting'">
                                        <span class="badge rounded-pill mb-4 tag-button text-light fs-6 px-3 py-2" i18n:translate="">Meeting</span>
                                    </tal:b>

                                    <tal:b tal:condition="activity.__class__.__name__ == 'Consultation'">
                                        <span class="badge rounded-pill mb-4 tag-button text-light fs-6 px-3 py-2" i18n:translate="">Consultation</span>
                                    </tal:b>
                                </div>

                                <div tal:condition="activity.__class__.__name__ == 'Consultation'"
                                        class="secondary-tags d-flex flex-row justify-content-start flex-xl-wrap">
                                    <tal:b tal:repeat="tag activity.secondary_tags">
                                        <span class="badge rounded-pill mb-4 bg-light text-dark fs-6 px-3 py-2 mx-1">${tag.name}</span>
                                    </tal:b>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar (1/3 width) -->
                <!-- Note: hidden until we decide to implement it -->
                <div class="col-md-4 order-md-2 mt-5" style="display: none;">
                    <div class="mb-5 p-3">
                        <label for="kantonDropdown" class="form-label">Kanton</label>
                        <select class="form-select" id="kantonDropdown" disabled>
                            <option selected i18n:translate="">Choose...</option>
                            <option value="1">ZÃ¼rich</option>
                            <option value="2">Genf</option>
                        </select>
                    </div>
                    <div class="mb-3 p-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" disabled>
                            <label class="form-check-label" for="beratungCheck">
                                Vernehmlassungen
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" disabled>
                            <label class="form-check-label" for="vorabkontrollenCheck">
                                Sitzungen
                            </label>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </tal:block>
</metal:block>
